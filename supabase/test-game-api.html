<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°æ¸¸æˆæ¥å£æµ‹è¯•å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 30px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .config-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .config-section h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 150px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .result-section {
            margin-top: 30px;
        }
        
        .result-section h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
        }
        
        .result-box {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .result-box.success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .result-box.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .result-box.info {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 10px;
        }
        
        .status-success {
            background: #28a745;
            color: white;
        }
        
        .status-error {
            background: #dc3545;
            color: white;
        }
        
        .status-warning {
            background: #ffc107;
            color: #333;
        }
        
        .test-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .test-item h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #333;
        }
        
        .test-item p {
            color: #666;
            font-size: 13px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® æ–°æ¸¸æˆæ¥å£æµ‹è¯•å·¥å…·</h1>
        <p class="subtitle">æµ‹è¯•æ–°æ¸¸æˆæ¥å£ (API v2.15.2) çš„å„é¡¹åŠŸèƒ½</p>
        
        <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 6px; padding: 15px; margin-bottom: 20px;">
            <strong>âš ï¸ CORS è·¨åŸŸé—®é¢˜è§£å†³æ–¹æ¡ˆï¼š</strong>
            <p style="margin: 10px 0 0 0; font-size: 14px; line-height: 1.6;">
                å½“å‰è®¿é—®åœ°å€ï¼š<code id="currentOrigin" style="background: #f8f9fa; padding: 2px 6px; border-radius: 3px;"></code><br><br>
                <strong>å·²ä¿®å¤ï¼š</strong> åç«¯ CORS é…ç½®å·²æ›´æ–°ï¼Œå·²æ·»åŠ  <code>admin.xpj66666.com</code> åˆ°å…è®¸åˆ—è¡¨<br>
                <strong>å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·ï¼š</strong><br>
                1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶åˆ·æ–°é¡µé¢ï¼ˆCtrl+F5ï¼‰<br>
                2. æ£€æŸ¥åç«¯æœåŠ¡å™¨æ˜¯å¦å·²é‡å¯å¹¶åŠ è½½æ–°çš„ CORS é…ç½®<br>
                3. åœ¨æµè§ˆå™¨æ§åˆ¶å°çš„ Network æ ‡ç­¾æŸ¥çœ‹å…·ä½“çš„ CORS é”™è¯¯ä¿¡æ¯<br>
                4. å¦‚æœåç«¯æœªé‡å¯ï¼Œè¯·è”ç³»åç«¯ç®¡ç†å‘˜é‡å¯ Laravel æœåŠ¡
            </p>
        </div>
        
        <div class="config-section">
            <h2>âš™ï¸ é…ç½®</h2>
            <div class="form-group">
                <label>API åŸºç¡€åœ°å€:</label>
                <input type="text" id="apiBaseUrl" value="https://api.amjsvip.cc/api/game-api" placeholder="https://api.amjsvip.cc/api/game-api">
            </div>
            <div class="form-group">
                <label>è®¤è¯ Token (å¯é€‰ï¼Œä¼šè‡ªåŠ¨è·å–):</label>
                <input type="text" id="authToken" placeholder="ç•™ç©ºå°†è‡ªåŠ¨åˆ›å»ºtoken">
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ§ª æµ‹è¯•åŠŸèƒ½</h2>
            
            <div class="test-item">
                <h3>1. åˆ›å»ºè®¿é—®ä»¤ç‰Œ</h3>
                <p>è·å–æ–°æ¸¸æˆæ¥å£çš„è®¤è¯ä»¤ç‰Œ</p>
                <button class="btn-primary" onclick="testCreateToken()">æµ‹è¯•åˆ›å»ºToken</button>
            </div>
            
            <div class="test-item">
                <h3>2. è·å–ä¾›åº”å•†åˆ—è¡¨</h3>
                <p>è·å–æ‰€æœ‰å¯ç”¨çš„æ¸¸æˆä¾›åº”å•†</p>
                <button class="btn-primary" onclick="testGetVendors()">æµ‹è¯•è·å–ä¾›åº”å•†åˆ—è¡¨</button>
            </div>
            
            <div class="test-item">
                <h3>3. è·å–æ¸¸æˆåˆ—è¡¨</h3>
                <p>æ ¹æ®ä¾›åº”å•†ä»£ç è·å–æ¸¸æˆåˆ—è¡¨</p>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <input type="text" id="vendorCode" placeholder="ä¾›åº”å•†ä»£ç  (å¦‚: slot-pragmatic)" style="flex: 1;">
                    <input type="text" id="gameLanguage" placeholder="è¯­è¨€ä»£ç  (å¦‚: zh)" value="zh" style="width: 100px;">
                    <button class="btn-primary" onclick="testGetGames()">æµ‹è¯•è·å–æ¸¸æˆåˆ—è¡¨</button>
                </div>
            </div>
            
            <div class="test-item">
                <h3>4. è·å–æ¸¸æˆå¯åŠ¨URL</h3>
                <p>è·å–æ¸¸æˆçš„å¯åŠ¨é“¾æ¥</p>
                <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
                    <input type="text" id="launchVendorCode" placeholder="ä¾›åº”å•†ä»£ç " style="flex: 1; min-width: 150px;">
                    <input type="text" id="launchGameCode" placeholder="æ¸¸æˆä»£ç  (å¦‚: lobby)" style="flex: 1; min-width: 150px;">
                    <input type="text" id="launchUserCode" placeholder="ç”¨æˆ·ä»£ç " style="flex: 1; min-width: 150px;">
                    <input type="text" id="launchLanguage" placeholder="è¯­è¨€" value="zh" style="width: 100px;">
                    <button class="btn-success" onclick="testGetLaunchUrl()">æµ‹è¯•è·å–å¯åŠ¨URL</button>
                </div>
            </div>
            
            <div class="test-item">
                <h3>5. è·å–æ¸¸æˆè¯¦æƒ…</h3>
                <p>è·å–æŒ‡å®šæ¸¸æˆçš„è¯¦ç»†ä¿¡æ¯</p>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <input type="text" id="detailVendorCode" placeholder="ä¾›åº”å•†ä»£ç " style="flex: 1;">
                    <input type="text" id="detailGameCode" placeholder="æ¸¸æˆä»£ç " style="flex: 1;">
                    <button class="btn-primary" onclick="testGetGameDetail()">æµ‹è¯•è·å–æ¸¸æˆè¯¦æƒ…</button>
                </div>
            </div>
            
            <div class="test-item">
                <h3>6. è·å–è¿·ä½ æ¸¸æˆåˆ—è¡¨</h3>
                <p>è·å–æ‰€æœ‰è¿·ä½ æ¸¸æˆ</p>
                <button class="btn-primary" onclick="testGetMiniGames()">æµ‹è¯•è·å–è¿·ä½ æ¸¸æˆåˆ—è¡¨</button>
            </div>
            
            <div class="button-group">
                <button class="btn-secondary" onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
                <button class="btn-danger" onclick="clearToken()">æ¸…é™¤Token</button>
                <button class="btn-primary" onclick="testButtonClick()" style="background: #17a2b8;">æµ‹è¯•æŒ‰é’®åŠŸèƒ½</button>
            </div>
        </div>
        
        <div class="result-section">
            <h2>ğŸ“Š æµ‹è¯•ç»“æœ <span id="statusBadge"></span></h2>
            <div id="resultBox" class="result-box">ç­‰å¾…æµ‹è¯•...</div>
        </div>
    </div>
    
    <script>
        // ç¡®ä¿æ‰€æœ‰å‡½æ•°éƒ½åœ¨å…¨å±€ä½œç”¨åŸŸ
        const API_BASE_URL_KEY = 'test_game_api_base_url';
        const AUTH_TOKEN_KEY = 'test_game_api_token';
        
        // è°ƒè¯•ï¼šæ£€æŸ¥æŒ‰é’®ç‚¹å‡»
        console.log('æµ‹è¯•é¡µé¢è„šæœ¬å·²åŠ è½½');
        
        // ========== å·¥å…·å‡½æ•° ==========
        function getApiBaseUrl() {
            const input = document.getElementById('apiBaseUrl');
            return input ? input.value || 'https://api.amjsvip.cc/api/game-api' : 'https://api.amjsvip.cc/api/game-api';
        }
        
        function getAuthToken() {
            const input = document.getElementById('authToken');
            return input ? (input.value || localStorage.getItem(AUTH_TOKEN_KEY)) : localStorage.getItem(AUTH_TOKEN_KEY);
        }
        
        function setAuthToken(token) {
            const input = document.getElementById('authToken');
            if (input) input.value = token;
            localStorage.setItem(AUTH_TOKEN_KEY, token);
        }
        
        function showResult(message, type = 'info') {
            const resultBox = document.getElementById('resultBox');
            const statusBadge = document.getElementById('statusBadge');
            
            if (!resultBox) {
                console.error('resultBoxå…ƒç´ æœªæ‰¾åˆ°');
                return;
            }
            
            resultBox.className = 'result-box ' + type;
            resultBox.textContent = message;
            
            // æ›´æ–°çŠ¶æ€å¾½ç« 
            if (statusBadge) {
                statusBadge.innerHTML = '';
                if (type === 'success') {
                    statusBadge.innerHTML = '<span class="status-badge status-success">æˆåŠŸ</span>';
                } else if (type === 'error') {
                    statusBadge.innerHTML = '<span class="status-badge status-error">å¤±è´¥</span>';
                } else {
                    statusBadge.innerHTML = '<span class="status-badge status-warning">è¿›è¡Œä¸­</span>';
                }
            }
        }
        
        function formatResponse(data) {
            return JSON.stringify(data, null, 2);
        }
        
        async function makeRequest(endpoint, method = 'GET', data = null) {
            const baseUrl = getApiBaseUrl();
            const url = `${baseUrl}${endpoint}`;
            const token = getAuthToken();
            
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                },
                mode: 'cors', // æ˜ç¡®æŒ‡å®šCORSæ¨¡å¼
                credentials: 'omit' // ä¸å‘é€cookies
            };
            
            if (token) {
                options.headers['Authorization'] = `Bearer ${token}`;
            }
            
            if (data && (method === 'POST' || method === 'PUT' || method === 'PATCH')) {
                options.body = JSON.stringify(data);
            }
            
            try {
                showResult(`è¯·æ±‚ä¸­...\nURL: ${url}\næ–¹æ³•: ${method}\n${data ? 'æ•°æ®: ' + JSON.stringify(data, null, 2) : ''}\nToken: ${token ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}`, 'info');
                
                const response = await fetch(url, options);
                const contentType = response.headers.get('content-type');
                
                let result;
                if (contentType && contentType.includes('application/json')) {
                    result = await response.json();
                } else {
                    const text = await response.text();
                    try {
                        result = JSON.parse(text);
                    } catch {
                        result = { message: text, success: false };
                    }
                }
                
                if (response.ok) {
                    showResult(`âœ… è¯·æ±‚æˆåŠŸ (${response.status})\n\nå“åº”æ•°æ®:\n${formatResponse(result)}`, 'success');
                    return result;
                } else {
                    showResult(`âŒ è¯·æ±‚å¤±è´¥ (${response.status})\n\né”™è¯¯ä¿¡æ¯:\n${formatResponse(result)}`, 'error');
                    throw new Error(result.message || result.error || `HTTP ${response.status}`);
                }
            } catch (error) {
                // è¯¦ç»†çš„é”™è¯¯å¤„ç†
                let errorMessage = `âŒ è¯·æ±‚å¼‚å¸¸\n\né”™è¯¯ç±»å‹: ${error.name}\né”™è¯¯æ¶ˆæ¯: ${error.message}`;
                
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    errorMessage += '\n\nå¯èƒ½çš„åŸå› :\n';
                    errorMessage += '1. CORSè·¨åŸŸé—®é¢˜ - åç«¯éœ€è¦é…ç½®CORSå¤´\n';
                    errorMessage += '2. ç½‘ç»œè¿æ¥é—®é¢˜ - è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥\n';
                    errorMessage += '3. URLä¸æ­£ç¡® - è¯·æ£€æŸ¥APIåœ°å€æ˜¯å¦æ­£ç¡®\n';
                    errorMessage += '4. æœåŠ¡å™¨æœªå“åº” - è¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ\n\n';
                    errorMessage += `è¯·æ±‚URL: ${url}\n`;
                    errorMessage += `è¯·æ±‚æ–¹æ³•: ${method}\n`;
                } else if (error.name === 'NetworkError' || error.message.includes('NetworkError')) {
                    errorMessage += '\n\nç½‘ç»œé”™è¯¯ï¼Œå¯èƒ½çš„åŸå› :\n';
                    errorMessage += '1. åç«¯æœåŠ¡å™¨æœªè¿è¡Œæˆ–æ— æ³•è®¿é—®\n';
                    errorMessage += '2. CORSç­–ç•¥é˜»æ­¢äº†è¯·æ±‚\n';
                    errorMessage += '3. é˜²ç«å¢™æˆ–ä»£ç†é˜»æ­¢äº†è¯·æ±‚\n';
                    errorMessage += '4. SSLè¯ä¹¦é—®é¢˜ï¼ˆHTTPSï¼‰\n\n';
                    errorMessage += 'å»ºè®®:\n';
                    errorMessage += '- æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ\n';
                    errorMessage += '- æ£€æŸ¥åç«¯CORSé…ç½®\n';
                    errorMessage += '- å°è¯•åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„Networkæ ‡ç­¾æŸ¥çœ‹è¯¦ç»†é”™è¯¯\n';
                }
                
                if (error.stack) {
                    errorMessage += `\nå †æ ˆä¿¡æ¯:\n${error.stack}`;
                }
                
                showResult(errorMessage, 'error');
                throw error;
            }
        }
        
        // å°†å‡½æ•°æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸ
        window.testCreateToken = async function() {
            console.log('testCreateToken è¢«è°ƒç”¨');
            try {
                showResult('æ­£åœ¨åˆ›å»ºè®¿é—®ä»¤ç‰Œ...\n\næ³¨æ„ï¼šTokenç”±åç«¯è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†ï¼Œè¿™é‡Œé€šè¿‡è°ƒç”¨ä¾›åº”å•†åˆ—è¡¨æ¥å£æ¥æµ‹è¯•è¿æ¥ã€‚', 'info');
                
                // æ³¨æ„ï¼šè¿™é‡Œéœ€è¦è°ƒç”¨åç«¯çš„tokenåˆ›å»ºæ¥å£
                // ç”±äºtokenåˆ›å»ºéœ€è¦clientIdå’ŒclientSecretï¼Œè¿™äº›ä¿¡æ¯åœ¨åç«¯
                // æ‰€ä»¥è¿™é‡Œç›´æ¥è°ƒç”¨åç«¯çš„ä»£ç†æ¥å£æ¥æµ‹è¯•è¿æ¥
                const result = await makeRequest('/vendors/list', 'GET');
                
                // å¦‚æœè¯·æ±‚æˆåŠŸï¼Œè¯´æ˜tokenå·²è‡ªåŠ¨åˆ›å»º
                showResult('âœ… è¿æ¥æˆåŠŸï¼Tokenå·²ç”±åç«¯è‡ªåŠ¨åˆ›å»ºï¼ˆé€šè¿‡åç«¯ä»£ç†ï¼‰\n\nä¾›åº”å•†åˆ—è¡¨å“åº”:\n' + formatResponse(result), 'success');
            } catch (error) {
                let errorMsg = 'âŒ Tokenåˆ›å»º/è¿æ¥å¤±è´¥\n\né”™è¯¯: ' + error.message;
                errorMsg += '\n\næ’æŸ¥æ­¥éª¤:\n';
                errorMsg += '1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ: è®¿é—® https://api.amjsvip.cc/api/game-api/vendors/list\n';
                errorMsg += '2. æ£€æŸ¥åç«¯CORSé…ç½®æ˜¯å¦æ­£ç¡®\n';
                errorMsg += '3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„Networkæ ‡ç­¾æŸ¥çœ‹è¯¦ç»†é”™è¯¯\n';
                errorMsg += '4. å¦‚æœä½¿ç”¨æœ¬åœ°å¼€å‘ï¼Œå¯èƒ½éœ€è¦é…ç½®ä»£ç†\n';
                showResult(errorMsg, 'error');
            }
        };
        
        window.testGetVendors = async function() {
            console.log('testGetVendors è¢«è°ƒç”¨');
            try {
                const result = await makeRequest('/vendors/list', 'GET');
                
                if (result.success && result.message && Array.isArray(result.message)) {
                    const vendors = result.message;
                    let vendorList = 'ä¾›åº”å•†åˆ—è¡¨:\n\n';
                    vendors.forEach((vendor, index) => {
                        vendorList += `${index + 1}. ${vendor.name} (${vendor.vendorCode})\n`;
                        vendorList += `   ç±»å‹: ${vendor.type === 1 ? 'çœŸäººå¨±ä¹åœº' : vendor.type === 2 ? 'è€è™æœº' : 'è¿·ä½ æ¸¸æˆ'}\n\n`;
                    });
                    showResult('âœ… è·å–ä¾›åº”å•†åˆ—è¡¨æˆåŠŸ\n\n' + vendorList + '\nå®Œæ•´å“åº”:\n' + formatResponse(result), 'success');
                } else {
                    showResult('âš ï¸ å“åº”æ ¼å¼å¼‚å¸¸\n\n' + formatResponse(result), 'error');
                }
            } catch (error) {
                // é”™è¯¯å·²åœ¨makeRequestä¸­æ˜¾ç¤º
            }
        };
        
        window.testGetGames = async function() {
            console.log('testGetGames è¢«è°ƒç”¨');
            const vendorCode = document.getElementById('vendorCode').value.trim();
            const language = document.getElementById('gameLanguage').value.trim() || 'zh';
            
            if (!vendorCode) {
                showResult('âŒ è¯·è¾“å…¥ä¾›åº”å•†ä»£ç ', 'error');
                return;
            }
            
            try {
                const result = await makeRequest('/games/list', 'POST', {
                    vendorCode,
                    language
                });
                
                if (result.success && result.message && Array.isArray(result.message)) {
                    const games = result.message;
                    let gameList = `æ¸¸æˆåˆ—è¡¨ (${games.length} ä¸ªæ¸¸æˆ):\n\n`;
                    games.slice(0, 10).forEach((game, index) => {
                        gameList += `${index + 1}. ${game.gameName} (${game.gameCode})\n`;
                    });
                    if (games.length > 10) {
                        gameList += `\n... è¿˜æœ‰ ${games.length - 10} ä¸ªæ¸¸æˆ\n`;
                    }
                    showResult('âœ… è·å–æ¸¸æˆåˆ—è¡¨æˆåŠŸ\n\n' + gameList + '\nå®Œæ•´å“åº”:\n' + formatResponse(result), 'success');
                } else {
                    showResult('âš ï¸ å“åº”æ ¼å¼å¼‚å¸¸\n\n' + formatResponse(result), 'error');
                }
            } catch (error) {
                // é”™è¯¯å·²åœ¨makeRequestä¸­æ˜¾ç¤º
            }
        };
        
        window.testGetLaunchUrl = async function() {
            console.log('testGetLaunchUrl è¢«è°ƒç”¨');
            const vendorCode = document.getElementById('launchVendorCode').value.trim();
            const gameCode = document.getElementById('launchGameCode').value.trim();
            const userCode = document.getElementById('launchUserCode').value.trim();
            const language = document.getElementById('launchLanguage').value.trim() || 'zh';
            
            if (!vendorCode || !gameCode || !userCode) {
                showResult('âŒ è¯·å¡«å†™æ‰€æœ‰å¿…éœ€å­—æ®µï¼šä¾›åº”å•†ä»£ç ã€æ¸¸æˆä»£ç ã€ç”¨æˆ·ä»£ç ', 'error');
                return;
            }
            
            try {
                const result = await makeRequest('/game/launch-url', 'POST', {
                    vendorCode,
                    gameCode,
                    userCode,
                    language
                });
                
                if (result.success && result.message) {
                    const gameUrl = result.message;
                    showResult('âœ… è·å–æ¸¸æˆå¯åŠ¨URLæˆåŠŸ\n\næ¸¸æˆURL:\n' + gameUrl + '\n\nå®Œæ•´å“åº”:\n' + formatResponse(result) + '\n\nğŸ’¡ æç¤º: å¯ä»¥å¤åˆ¶ä¸Šé¢çš„URLåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æµ‹è¯•', 'success');
                } else {
                    showResult('âš ï¸ å“åº”æ ¼å¼å¼‚å¸¸\n\n' + formatResponse(result), 'error');
                }
            } catch (error) {
                // é”™è¯¯å·²åœ¨makeRequestä¸­æ˜¾ç¤º
            }
        };
        
        window.testGetGameDetail = async function() {
            console.log('testGetGameDetail è¢«è°ƒç”¨');
            const vendorCode = document.getElementById('detailVendorCode').value.trim();
            const gameCode = document.getElementById('detailGameCode').value.trim();
            
            if (!vendorCode || !gameCode) {
                showResult('âŒ è¯·å¡«å†™ä¾›åº”å•†ä»£ç å’Œæ¸¸æˆä»£ç ', 'error');
                return;
            }
            
            try {
                const result = await makeRequest('/game/detail', 'POST', {
                    vendorCode,
                    gameCode
                });
                
                if (result.success && result.message) {
                    const game = result.message;
                    let detail = `æ¸¸æˆè¯¦æƒ…:\n\n`;
                    detail += `æ¸¸æˆåç§°: ${game.gameName}\n`;
                    detail += `æ¸¸æˆä»£ç : ${game.gameCode}\n`;
                    detail += `ä¾›åº”å•†: ${game.vendorCode}\n`;
                    detail += `æä¾›å•†: ${game.provider}\n`;
                    detail += `æ˜¯å¦æ–°æ¸¸æˆ: ${game.isNew ? 'æ˜¯' : 'å¦'}\n`;
                    detail += `æ˜¯å¦ç»´æŠ¤ä¸­: ${game.underMaintenance ? 'æ˜¯' : 'å¦'}\n`;
                    if (game.thumbnail) {
                        detail += `ç¼©ç•¥å›¾: ${game.thumbnail}\n`;
                    }
                    showResult('âœ… è·å–æ¸¸æˆè¯¦æƒ…æˆåŠŸ\n\n' + detail + '\nå®Œæ•´å“åº”:\n' + formatResponse(result), 'success');
                } else {
                    showResult('âš ï¸ å“åº”æ ¼å¼å¼‚å¸¸\n\n' + formatResponse(result), 'error');
                }
            } catch (error) {
                // é”™è¯¯å·²åœ¨makeRequestä¸­æ˜¾ç¤º
            }
        };
        
        window.testGetMiniGames = async function() {
            console.log('testGetMiniGames è¢«è°ƒç”¨');
            try {
                const result = await makeRequest('/games/mini/list', 'GET');
                
                if (result.success && result.message && Array.isArray(result.message)) {
                    const games = result.message;
                    let gameList = `è¿·ä½ æ¸¸æˆåˆ—è¡¨ (${games.length} ä¸ªæ¸¸æˆ):\n\n`;
                    games.forEach((game, index) => {
                        gameList += `${index + 1}. ${game.gameName} (${game.gameCode})\n`;
                    });
                    showResult('âœ… è·å–è¿·ä½ æ¸¸æˆåˆ—è¡¨æˆåŠŸ\n\n' + gameList + '\nå®Œæ•´å“åº”:\n' + formatResponse(result), 'success');
                } else {
                    showResult('âš ï¸ å“åº”æ ¼å¼å¼‚å¸¸\n\n' + formatResponse(result), 'error');
                }
            } catch (error) {
                // é”™è¯¯å·²åœ¨makeRequestä¸­æ˜¾ç¤º
            }
        }
        
        window.clearResults = function() {
            console.log('clearResults è¢«è°ƒç”¨');
            showResult('ç­‰å¾…æµ‹è¯•...', 'info');
            document.getElementById('statusBadge').innerHTML = '';
        };
        
        window.clearToken = function() {
            console.log('clearToken è¢«è°ƒç”¨');
            document.getElementById('authToken').value = '';
            localStorage.removeItem(AUTH_TOKEN_KEY);
            showResult('âœ… Tokenå·²æ¸…é™¤', 'success');
        };
        
        window.testConnection = async function() {
            console.log('testConnection è¢«è°ƒç”¨');
            try {
                showResult('æ­£åœ¨æµ‹è¯•APIè¿æ¥...\n\næ£€æŸ¥:\n1. APIåœ°å€æ˜¯å¦æ­£ç¡®\n2. æœåŠ¡å™¨æ˜¯å¦å¯è®¿é—®\n3. CORSé…ç½®æ˜¯å¦æ­£ç¡®', 'info');
                
                const baseUrl = getApiBaseUrl();
                
                // å…ˆæµ‹è¯•ç®€å•çš„GETè¯·æ±‚
                const testUrl = baseUrl + '/vendors/list';
                
                showResult(`æµ‹è¯•è¿æ¥ä¸­...\nURL: ${testUrl}\n\nå¦‚æœå‡ºç°CORSé”™è¯¯ï¼Œè¯´æ˜:\n1. åç«¯CORSæœªé…ç½®\n2. éœ€è¦ä½¿ç”¨ä»£ç†\n3. æˆ–ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•`, 'info');
                
                const result = await makeRequest('/vendors/list', 'GET');
                
                showResult('âœ… è¿æ¥æµ‹è¯•æˆåŠŸï¼\n\nAPIåœ°å€æ­£ç¡®ï¼ŒæœåŠ¡å™¨å¯è®¿é—®ï¼ŒCORSé…ç½®æ­£å¸¸ã€‚\n\nå“åº”:\n' + formatResponse(result), 'success');
            } catch (error) {
                let errorMsg = 'âŒ è¿æ¥æµ‹è¯•å¤±è´¥\n\n';
                
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    errorMsg += 'å¯èƒ½çš„åŸå› :\n';
                    errorMsg += '1. âŒ CORSè·¨åŸŸé—®é¢˜ï¼ˆæœ€å¸¸è§ï¼‰\n';
                    errorMsg += '   - åç«¯éœ€è¦é…ç½®CORSå¤´: Access-Control-Allow-Origin\n';
                    errorMsg += '   - æˆ–ä½¿ç”¨ä»£ç†æœåŠ¡å™¨\n\n';
                    errorMsg += '2. âŒ æœåŠ¡å™¨æœªè¿è¡Œæˆ–æ— æ³•è®¿é—®\n';
                    errorMsg += '   - æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨\n';
                    errorMsg += '   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®\n\n';
                    errorMsg += '3. âŒ URLåœ°å€ä¸æ­£ç¡®\n';
                    errorMsg += '   - æ£€æŸ¥APIåŸºç¡€åœ°å€æ˜¯å¦æ­£ç¡®\n';
                    errorMsg += '   - å°è¯•åœ¨æµè§ˆå™¨ç›´æ¥è®¿é—®: ' + getApiBaseUrl() + '/vendors/list\n\n';
                    errorMsg += 'è§£å†³æ–¹æ¡ˆ:\n';
                    errorMsg += 'æ–¹æ¡ˆ1: é…ç½®åç«¯CORSï¼ˆæ¨èï¼‰\n';
                    errorMsg += '  åœ¨Laravelçš„ config/cors.php ä¸­æ·»åŠ :\n';
                    errorMsg += '  "allowed_origins" => ["*"] æˆ– ["http://localhost:3000"]\n\n';
                    errorMsg += 'æ–¹æ¡ˆ2: ä½¿ç”¨ä»£ç†\n';
                    errorMsg += '  åœ¨ vite.config.ts ä¸­é…ç½®ä»£ç†\n\n';
                    errorMsg += 'æ–¹æ¡ˆ3: ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•\n';
                    errorMsg += '  å°†HTMLæ–‡ä»¶æ”¾åˆ°æœåŠ¡å™¨ä¸Šè®¿é—®\n';
                } else {
                    errorMsg += 'é”™è¯¯: ' + error.message;
                }
                
                showResult(errorMsg, 'error');
            }
        };
        
        // æµ‹è¯•å‡½æ•°æ˜¯å¦å¯ç”¨
        window.testButtonClick = function() {
            console.log('æµ‹è¯•æŒ‰é’®ç‚¹å‡»åŠŸèƒ½æ­£å¸¸ï¼');
            showResult('âœ… JavaScriptæ­£å¸¸å·¥ä½œï¼\n\næ‰€æœ‰å‡½æ•°å·²åŠ è½½ï¼ŒæŒ‰é’®ç‚¹å‡»åŠŸèƒ½æ­£å¸¸ã€‚', 'success');
        };
        
        // ========== åˆå§‹åŒ– ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMå·²åŠ è½½ï¼Œå¼€å§‹åˆå§‹åŒ–');
            
            // æ˜¾ç¤ºå½“å‰è®¿é—®åœ°å€
            const currentOriginEl = document.getElementById('currentOrigin');
            if (currentOriginEl) {
                currentOriginEl.textContent = window.location.origin;
            }
            
            const savedBaseUrl = localStorage.getItem(API_BASE_URL_KEY);
            const savedToken = localStorage.getItem(AUTH_TOKEN_KEY);
            
            const apiBaseUrlInput = document.getElementById('apiBaseUrl');
            const authTokenInput = document.getElementById('authToken');
            
            if (apiBaseUrlInput && savedBaseUrl) {
                apiBaseUrlInput.value = savedBaseUrl;
            }
            if (authTokenInput && savedToken) {
                authTokenInput.value = savedToken;
            }
            
            // ä¿å­˜é…ç½®å˜åŒ–
            if (apiBaseUrlInput) {
                apiBaseUrlInput.addEventListener('change', function() {
                    localStorage.setItem(API_BASE_URL_KEY, this.value);
                });
            }
            
            if (authTokenInput) {
                authTokenInput.addEventListener('change', function() {
                    if (this.value) {
                        localStorage.setItem(AUTH_TOKEN_KEY, this.value);
                    } else {
                        localStorage.removeItem(AUTH_TOKEN_KEY);
                    }
                });
            }
            
            console.log('æ‰€æœ‰å‡½æ•°å·²å®šä¹‰:', {
                testCreateToken: typeof window.testCreateToken,
                testGetVendors: typeof window.testGetVendors,
                testGetGames: typeof window.testGetGames,
                testGetLaunchUrl: typeof window.testGetLaunchUrl,
                testGetGameDetail: typeof window.testGetGameDetail,
                testGetMiniGames: typeof window.testGetMiniGames,
                clearResults: typeof window.clearResults,
                clearToken: typeof window.clearToken,
                testConnection: typeof window.testConnection,
                testButtonClick: typeof window.testButtonClick
            });
            
            console.log('å½“å‰è®¿é—®åœ°å€:', window.location.origin);
            console.log('APIåœ°å€:', getApiBaseUrl());
        });
    </script>
</body>
</html>